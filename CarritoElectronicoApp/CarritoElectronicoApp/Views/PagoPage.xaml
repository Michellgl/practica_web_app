<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CarritoElectronicoApp.Views.PagoPage"
             Title="Confirmar Pago"
             BackgroundColor="#F5F5F5">

    <Grid>

        <ScrollView x:Name="ContenidoPrincipal">
            <VerticalStackLayout Padding="20" Spacing="25">

                <Label Text="Resumen del Pedido"
                       FontSize="24"
                       FontAttributes="Bold"
                       TextColor="#1a1a1a"
                       HorizontalOptions="Center"/>

                <CollectionView x:Name="ListaResumen"
                                HeightRequest="300"
                                SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame CornerRadius="12"
                                   Padding="15"
                                   Margin="0,5"
                                   BackgroundColor="White"
                                   HasShadow="True"
                                   BorderColor="Transparent">

                                <Grid ColumnDefinitions="*, Auto, Auto" ColumnSpacing="15">
                                    <Label Text="{Binding Nombre}"
                                           FontSize="16"
                                           VerticalOptions="Center"
                                           TextColor="#333"
                                           FontAttributes="Bold"
                                           LineBreakMode="TailTruncation"/>

                                    <Label Grid.Column="1"
                                           Text="{Binding Cantidad, StringFormat='x {0}'}"
                                           TextColor="#666"
                                           VerticalOptions="Center"/>

                                    <Label Grid.Column="2"
                                           Text="{Binding Precio, StringFormat='${0:F2}'}"
                                           TextColor="#2E7D32"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <BoxView HeightRequest="1" Color="#E0E0E0" />

                <Frame BackgroundColor="White"
                       CornerRadius="15"
                       Padding="20"
                       HasShadow="False"
                       BorderColor="#E0E0E0">
                    <HorizontalStackLayout HorizontalOptions="Center" Spacing="10">
                        <Label Text="Total a Pagar:" 
                               FontSize="20" 
                               TextColor="#555" 
                               VerticalOptions="Center"/>
                        <Label x:Name="LabelTotal"
                               FontSize="28"
                               FontAttributes="Bold"
                               TextColor="#2E7D32"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </Frame>

                <VerticalStackLayout Spacing="10">
                    <Label Text="Método de Pago"
                           FontAttributes="Bold"
                           TextColor="#333"
                           FontSize="18"/>

                    <Frame BackgroundColor="White"
                           CornerRadius="12"
                           Padding="0"
                           BorderColor="#BDBDBD">
                        <Picker x:Name="PickerMetodoPago"
                                Title="Selecciona una opción"
                                TitleColor="#999"
                                TextColor="Black"
                                BackgroundColor="Transparent"
                                HeightRequest="55"
                                HorizontalTextAlignment="Center">
                            <Picker.Items>
                                <x:String>Efectivo</x:String>
                                <x:String>Tarjeta de Crédito</x:String>
                                <x:String>Tarjeta de Débito</x:String>
                                <x:String>PayPal</x:String>
                                <x:String>Transferencia</x:String>
                            </Picker.Items>
                        </Picker>
                    </Frame>
                </VerticalStackLayout>

                <Button x:Name="BtnPagar"
                        Text="Confirmar y Pagar"
                        BackgroundColor="#2E7D32"
                        TextColor="White"
                        CornerRadius="25"
                        FontSize="18"
                        FontAttributes="Bold"
                        HeightRequest="60"
                        Margin="0,20,0,0"
                        Shadow="{Shadow Brush=Black, Offset='0,5', Radius=5, Opacity=0.2}"
                        Clicked="OnConfirmarPagoClicked"/>

            </VerticalStackLayout>
        </ScrollView>

        <Grid x:Name="LoadingOverlay"
              BackgroundColor="#80000000"
              IsVisible="False"
              HorizontalOptions="Fill"
              VerticalOptions="Fill">

            <Frame BackgroundColor="White"
                   CornerRadius="20"
                   WidthRequest="200"
                   HeightRequest="150"
                   HorizontalOptions="Center"
                   VerticalOptions="Center">
                <VerticalStackLayout Spacing="20" VerticalOptions="Center">
                    <ActivityIndicator IsRunning="True" 
                                       Color="#2E7D32"
                                       HeightRequest="50"
                                       WidthRequest="50"/>
                    <Label Text="Procesando Pago..."
                           TextColor="#333"
                           HorizontalOptions="Center"
                           FontAttributes="Bold"/>
                </VerticalStackLayout>
            </Frame>
        </Grid>

    </Grid>
</ContentPage>